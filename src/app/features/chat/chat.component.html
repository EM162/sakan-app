<div class="chat-wrapper">
  <div class="chat-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h2>Messages</h2>
      </div>
      <div class="chat-list">
        <div
          *ngFor="let chat of chats"
          [class.active]="selectedChat?.chatId === chat.chatId"
          class="chat-item"
          (click)="selectChat(chat)"
        >
          <div class="chat-item-content">
            <i class="fas fa-home"></i>
            <div class="chat-item-details">
              <div class="chat-header-row">
                <h5 class="chat-username">{{ getUserName(chat) }}</h5>
                <span class="status-badge" [ngClass]="chat.listingStatus?.toLowerCase()">
                  {{ chat.listingStatus }}
                </span>
              </div>
              <p class="lead">{{ getLatestMessage(chat) }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Main -->
    <div class="chat-main">

      <!-- Header -->
      <div *ngIf="selectedChat" class="chat-header">
        <h2>
          <a
            [routerLink]="['/listing', selectedChat.listingId]"
            class="listing-link"
          >
            {{ selectedChat.listingTitle }}
          </a>
          - {{ selectedChat.hostName }}
        </h2>

        <ng-container [ngSwitch]="approvalStatus">
  
          <button
            *ngSwitchCase="'GoToPayment'"
            class="btn success"
            (click)="goToPayment()"
          >
            Go to Payment
          </button>
        
          <span *ngSwitchCase="'PendingHost'" class="status-msg pending">
            Waiting for host approval
          </span>
        
          <span *ngSwitchCase="'PendingGuest'" class="status-msg pending">
            Waiting for guest approval
          </span>
        
          <span *ngSwitchCase="'PendingUserBooking'" class="status-msg pending">
            Waiting for guest to complete booking
          </span>
        
          <button
            *ngSwitchDefault
            class="approve-btn"
            (click)="onApproveClick()"
          >
            Approve
          </button>
        </ng-container>
        
        
        
      </div>

      <!-- No Chat Selected -->
      <div *ngIf="!selectedChat" class="no-chat-selected">
        <h3>Select a conversation to start messaging</h3>
      </div>

      <!-- Chat Messages -->
      <div *ngIf="selectedChat" class="chat-messages" #chatMessagesContainer>
        <div
          *ngFor="let message of messages"
          [ngClass]="{
            message: true,
            'message-sent': message.senderID?.trim()?.toLowerCase() === currentUserId?.trim().toLowerCase(),
            'message-received': message.senderID?.trim()?.toLowerCase() !== currentUserId?.trim().toLowerCase()
          }"
        >
          <div class="message-content">
            <strong>
              {{
                message.senderID?.trim()?.toLowerCase() === currentUserId?.trim().toLowerCase()
                  ? "You"
                  : "Other"
              }}:
            </strong>
            {{ message.content }}
          </div>

          <div class="message-time">
            {{ message.timestamp | date : "hh:mm a" }}
          </div>
        </div>
      </div>

      <!-- Chat Input -->
      <div *ngIf="selectedChat" class="chat-input">
        <input
          type="text"
          [(ngModel)]="newMessage"
          placeholder="Type your message..."
          (keyup.enter)="sendMessage()"
        />
        <button (click)="sendMessage()">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>
</div>
